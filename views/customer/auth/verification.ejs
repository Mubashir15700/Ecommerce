<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Shoppers</title>
    <link rel="stylesheet" href="/admin/css/vertical-layout-light/style.css">
</head>

<body>
    <div class="container-scroller">
        <div class="container-fluid page-body-wrapper full-page-wrapper">
            <div class="content-wrapper d-flex align-items-center auth px-0">
                <div class="row w-100 mx-0">
                    <div class="col-lg-4 mx-auto">
                        <div class="auth-form-light text-left py-5 px-4 px-sm-5">
                            <div>
                                <img src="/shoppers.svg" class="mr-2" alt="logo" height="50" width="130" />
                                <p class="font-weight-light">Verify to continue.</p>
                            </div>
                            <form action="/verification" method="post" class="pt-3">
                                <div class="form-group">
                                    <input type="hidden" value="<%= userId %>" name="userId">
                                    <input type="hidden" value="<%= email %>" name="email">
                                    <input type="number" class="form-control form-control-lg" id="exampleInputOTP1"
                                        placeholder="OTP" name="otp">
                                    <input type="hidden" value="<%= isForgotPassword %>" name="isForgotPassword">
                                    <p class="text-danger" id="otp-error-display"></p>
                                </div>
                                <div class="mt-3">
                                    <button type="submit"
                                        class="btn btn-block btn-primary btn-lg font-weight-medium auth-form-btn">
                                        Verify
                                    </button>
                                    <p>Time remaining: <span id="countdown">05:00</span></p>
                                </div>
                            </form>
                            <form action="/resend-otp" method="post" id="resendForm">
                                <input type="hidden" value="<%= userId %>" name="id">
                                <input type="hidden" value="<%= email %>" name="email">
                                <input type="hidden" value="<%= isForgotPassword %>" name="isForgotPassword">
                                <p class="text-danger"><%= error %></p>
                                <a href="#" id="submitLink">Resend OTP</a>
                                <p id="hidden" hidden>Please check your inbox.</p>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById("submitLink").addEventListener("click", function (e) {
            e.preventDefault();
            document.getElementById("resendForm").submit();
            setTimeout(() => {
                document.getElementById("hidden").removeAttribute("hidden");
            }, 1000);
        });


        // Set the expiration time for the OTP to 5 minutes from the current time.
        const otpExpirationTime = Date.now() + 60000 * 5; // 5 minutes in milliseconds.
        // Get the countdown element by its ID.
        const countdownElement = document.getElementById('countdown');

        // Function to update the countdown timer.
        function updateCountdown() {
            const now = Date.now(); // Current time in milliseconds.
            const timeRemaining = otpExpirationTime - now;

            // Calculate minutes and seconds remaining.
            const minutes = Math.floor((timeRemaining / 1000) / 60);
            const seconds = Math.floor((timeRemaining / 1000) % 60);

            // Format the time as "mm:ss".
            const formattedTime = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            // Update the countdown element.
            countdownElement.textContent = formattedTime;
            
            // Check if the OTP has expired.
            if (timeRemaining <= 0) {
                clearInterval(intervalId); // Stop the countdown when it reaches 00:00 or goes negative.
                countdownElement.textContent = '00:00'; // Display 00:00 when the OTP expires.
            }
        }

        // Initial call to set up the countdown.
        updateCountdown();

        // Update the countdown every second.
        const intervalId = setInterval(updateCountdown, 1000);

    </script>

</body>

</html>