<!DOCTYPE html>
<html lang="en">

<%- include('../partials/admin/head') -%>

    <body>
        <div class="container-scroller">
            <%- include('../partials/admin/header') -%>
                <div class="main-panel">
                    <div class="content-wrapper my-custom-wrapper">
                        <div class="col-lg-12 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Sales Report</h4>
                                    <form action="/admin/sales-report?filtered=true" method="post">
                                        <input type="date" name="from">
                                        <input type="date" name="upto">
                                        <button class="btn btn-secondary btn-sm" type="submit">Apply</button>
                                    </form>
                                    <div class="table-responsive">
                                        <% let productsCount = 0 %>
                                        <% let totalRevenue = 0 %>
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>
                                                        User
                                                    </th>
                                                    <th>
                                                        Order Details
                                                    </th>
                                                    <th>
                                                        Order Date
                                                    </th>
                                                    <th>
                                                        Delivery Address
                                                    </th>
                                                    <th>
                                                        Payment Method
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% if (!salesReport.length) { %>
                                                    <tr>
                                                        <td colspan="6">
                                                            No data found.
                                                        </td>
                                                    </tr>
                                                <% } else { %>
                                                    <% salesReport.forEach((report) => { %>
                                                        <% totalRevenue += report.totalAmount %>
                                                        <tr>
                                                            <td>
                                                                <%= report.user.username %><br>
                                                                <p class="text-dark"><%= report.user.email %></p><br>
                                                                <%= report.user.phone %>
                                                             </td>
                                                             <td>
                                                                <div>
                                                                <% report.products.forEach((product) => { %>
                                                                    <% productsCount += 1 %>
                                                                    <div class="border-bottom mb-3">
                                                                        <span class="text-primary h6 text-uppercase">
                                                                            <%= product.product.name %> 
                                                                        </span><br>
                                                                        Price: <%= product.product.price %> <br>
                                                                        Quantity: <%= product.quantity %> <br>
                                                                    </div>
                                                                <% }) %>
                                                            </td>
                                                            <td>
                                                                Order Confirmed, <%= report.orderDate.toLocaleDateString() %><br>
                                                                Delivery, <%= report.deliveryDate.toLocaleDateString() %>
                                                            </td>
                                                            <td>
                                                                <%= report.deliveryAddress.state %>,
                                                                <%= report.deliveryAddress.city %><br>
                                                                <%= report.deliveryAddress.area %>,
                                                                Pincode: <%= report.deliveryAddress.pincode %><br>
                                                                House No.: <%= report.deliveryAddress.building %>
                                                            </td>
                                                            <td>
                                                                <%= report.paymentMethod %>
                                                            </td>
                                                        </tr>
                                                    <% }) %>
                                                <% } %>
                                            </tbody>
                                        </table>
                                        <div class="col-lg-12 border-top">
                                            Total orders done: <%= salesReport.length %><br>
                                            Total products sold: <%= productsCount %><br>
                                            Total Revenue: â‚¹<%= totalRevenue.toFixed(2) %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <%- include('../partials/admin/footer') -%>